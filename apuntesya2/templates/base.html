<!doctype html>
<html lang="es">

<head>
  <style>
    .nav-profile-pic {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #fff;
      box-shadow: 0 0 4px rgba(0, 0, 0, 0.3);
    }
  </style>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ApuntesYa</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <style>
    .nav-profile-pic {
      display: block;
      width: fit-content;
      margin: 0 auto;

      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
  </style>
</head>

<body>
  <div class="nav">
    <div class="brand">
      <a href="{{ url_for('index') }}" class="brand-logo-link">
        <img src="{{ url_for('static', filename='img/logo.png') }}" alt="ApuntesYa" class="brand-logo-img">
      </a>
      <a href="{{ url_for('index') }}" class="brand-logo-link">
        <img src="{{ url_for('static', filename='img/logo1.png') }}" alt="ApuntesYa" class="brand-logo1-img">
      </a>
    </div>
    <div class="nav-actions">
      <a href="{{ url_for('index') }}" class="btn ghost">Inicio</a>

      {% if current_user.is_authenticated %}
      <a href="{{ url_for('upload_note') }}" class="btn">Subir apunte</a>
      <a href="{{ url_for('profile') }}" class="btn secondary">Perfil</a>

      {% if current_user.is_authenticated and current_user.is_admin %}
      <a href="{{ url_for('admin_hub') }}" class="btn ghost">Administrar</a>
      {% endif %}

      <a href="{{ url_for('logout') }}" class="btn ghost">Salir</a>

      <a href="{{ url_for('profile') }}" style="display:inline-flex;align-items:center;gap:8px">
        <img
          src="{% if (current_user.imagen_de_perfil or current_user.profile_image) %}{{ url_for('static', filename='uploads/profile_images/' ~ (current_user.imagen_de_perfil or current_user.profile_image)) }}{% else %}{{ url_for('static', filename='img/default_profile.png') }}{% endif %}"
          class="nav-profile-pic" alt="Foto de perfil">
      </a>
      {% else %}
      <a href="{{ url_for('login') }}" class="btn ghost">Ingresar/Registrarse</a>
      {% endif %}
    </div>

  </div>
  <div class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="card">{{ message }}</div>
    {% endfor %}
    {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </div>
  <div class="footer">
    <div class="footer">
      Hecho con ‚ô• ‚Äî Comisi√≥n plataforma: {{ config.get('PLATFORM_FEE_PERCENT', 20.0) }}%
      <a class="btn ghost" href="{{ url_for('terms') }}">T√©rminos y condiciones</a>
    </div>
  </div>

  <!-- Contact Widget: button, overlay, and panel -->
  <button id="contact-widget-button" aria-expanded="false" aria-controls="contact-widget-panel"
    aria-label="Abrir contacto" title="Contactar ApuntesYa"
    class="bg-blue-600 text-white text-lg flex items-center justify-center shadow-lg">
    üí¨
  </button>

  <div id="contact-widget-overlay" class="hidden"></div>

  <div id="contact-widget-panel" class="hidden">
    <div class="contact-header">
      <div>
        <div class="contact-title">¬øNecesit√°s ayuda?</div>
        <div class="contact-sub">Escribinos por WhatsApp o correo</div>
      </div>
      <button id="contact-widget-close" aria-label="Cerrar" title="Cerrar"
        style="border:none;background:transparent;font-size:20px;line-height:1;cursor:pointer;">√ó</button>
    </div>

    <div class="contact-row">
      {% if CONTACT_WHATSAPP %}
      {% set wa_digits = CONTACT_WHATSAPP|replace('+','')|replace(' ','') %}
      <a class="contact-chip" target="_blank" rel="noopener"
        href="https://wa.me/{{ wa_digits }}?text={{ 'Hola ApuntesYa, necesito ayuda.'|urlencode }}">
        <span class="ico">üì≤</span>
        <span>WhatsApp {{ CONTACT_WHATSAPP }}</span>
      </a>
      {% endif %}

      {% for em in CONTACT_EMAILS %}
      <a class="contact-chip" href="mailto:{{ em }}?subject={{ 'Consulta desde ApuntesYa'|urlencode }}">
        <span class="ico">‚úâÔ∏è</span>
        <span>{{ em }}</span>
      </a>
      {% endfor %}

      {% if SUGGESTIONS_URL %}
      <a class="contact-chip contact-primary" target="_blank" rel="noopener" href="{{ SUGGESTIONS_URL }}">
        <span class="ico">üìù</span>
        <span>Enviar sugerencia</span>
      </a>
      {% endif %}

    </div>
  </div>

  {# Bloque para inyectar JS espec√≠ficos de cada p√°gina (p.ej. selects) #}
  {% block extra_js %}{% endblock %}

  <!-- <script src="{{ url_for('static', filename='js/contact_widget.js') }}"></script>  -->

  <!-- Toast simple -->
  <div id="apy-toast"
    style="position:fixed;right:16px;bottom:16px;z-index:9999;display:none;background:#111827;color:#fff;padding:12px 16px;border-radius:10px;box-shadow:0 10px 20px rgba(0,0,0,.2)">
  </div>
  <script>
    (function () {
      function showToast(msg) {
        var t = document.getElementById('apy-toast');
        if (!t) return;
        t.textContent = msg;
        t.style.display = 'block';
        setTimeout(function () { t.style.display = 'none'; }, 3500);
      }
      // lee flashes si est√°n en DOM
      var el = document.querySelector('.flash-success, .flash'); // depende de tu render
      // fallback por query param
      var usp = new URLSearchParams(location.search);
      if (usp.get('paid') === '1') {
        showToast('‚úÖ Pago aprobado, ya pod√©s descargar.');
        // scroll al bot√≥n de descarga si existe
        var btn = document.getElementById('download-btn');
        if (btn) { btn.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
      }
    })();
  </script>

</body>

</html>