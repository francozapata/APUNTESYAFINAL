{% extends "base.html" %}
{% block content %}
<style>
  .shell {
    max-width: 980px;
    margin: 28px auto;
  }

  .card {
    background: #fff;
    border: 1px solid #e5e7f5;
    border-radius: 16px;
    padding: 18px;
  }

  .grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 14px;
  }

  @media (min-width: 860px) {
    .grid {
      grid-template-columns: 1fr 1fr;
    }
  }

  label {
    font-weight: 700;
    font-size: 13px;
  }

  /* No usar width:100% para TODOS los inputs porque rompe los checkbox */
  input[type="text"],
  input[type="number"],
  textarea {
    width: 100%;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid #dbe2ff;
  }

  textarea {
    min-height: 90px;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 10px 14px;
    border-radius: 12px;
    background: #4478ff;
    color: #fff;
    border: none;
    cursor: pointer;
    text-decoration: none;
  }

  .btn.cancel {
    background: #111827;
  }

  .note {
    display: grid;
    grid-template-columns: 22px 1fr;
    gap: 10px;
    align-items: flex-start;
    border: 1px solid #eef2ff;
    border-radius: 12px;
    padding: 10px;
    margin-top: 10px;
    cursor: pointer;
    transition: transform 120ms ease, box-shadow 120ms ease;
  }

  .note:hover {
    box-shadow: 0 8px 18px rgba(15, 23, 42, 0.06);
    transform: translateY(-1px);
  }

  .note.checked {
    border-color: #bcd0ff;
    background: #f6f8ff;
  }

  .note input[type="checkbox"] {
    width: 16px;
    height: 16px;
    margin-top: 3px;
  }

  .meta {
    color: #6b7280;
    font-size: 13px;
  }

  .helper {
    margin-top: 8px;
    color: #6b7280;
    font-size: 13px;
    display: flex;
    justify-content: space-between;
    gap: 10px;
    flex-wrap: wrap;
  }

  .pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid #e5e7f5;
    background: #fff;
    font-size: 12px;
  }
</style>

<div class="shell">
  <div class="card">
    <h2 style="margin:0 0 12px 0">Crear combo</h2>

    <form method="post">
      <div class="grid">
        <div>
          <label>TÃ­tulo</label>
          <input name="title" required placeholder="Ej: Pack final Ãlgebra I" />
        </div>

        <div>
          <label>Neto que quiero recibir (ARS)</label>
          <input name="price_net" type="number" min="0" step="0.1" placeholder="0 para gratis" />
          <div class="meta" style="margin-top:6px">
            Publicamos el combo sumando un <b>18%</b> (10% plataforma + 8% Mercado Pago), con redondeo <b>siempre para arriba</b> y <b>1 decimal</b>.
            Ejemplo: si querÃ©s recibir $10, se publica a $12.2.
          </div>
        </div>
      </div>

      <div style="margin-top:12px">
        <label>DescripciÃ³n</label>
        <textarea name="description" required
          placeholder="QuÃ© incluye el combo, alcance, aÃ±o, cÃ¡tedra, etc."></textarea>
      </div>

      <div style="margin-top:14px">
        <label>SeleccionÃ¡ al menos 2 apuntes</label>
        <div class="helper">
          <span class="pill" id="selectedPill">âœ… Seleccionados: <b id="selectedCount">0</b></span>
          <span class="pill">ðŸ’¡ Tip: armÃ¡ un pack por materia / parcial / final</span>
        </div>

        {% if notes and notes|length > 0 %}
        {% for n in notes %}
        <label class="note" data-note>
          <input type="checkbox" name="note_ids" value="{{ n.id }}" />
          <div>
            <div style="font-weight:800">
              {{ n.title }}
            </div>
            <div class="meta">
              {{ n.university or "" }}
              {% if n.university %} Â· {% endif %}
              {{ n.faculty or "" }}
              {% if n.faculty %} Â· {% endif %}
              {{ n.career or "" }}
            </div>
          </div>
        </label>
        {% endfor %}
        {% else %}
        <div class="meta" style="margin-top:6px">
          No tenÃ©s apuntes aprobados disponibles para armar combos.
        </div>
        {% endif %}
      </div>

      <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end">
        <a class="btn cancel" href="{{ url_for('my_notes_hub') }}">
          Cancelar
        </a>
        <button class="btn" type="submit">
          Crear combo
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  (function () {
    const notes = Array.from(document.querySelectorAll('[data-note]'));
    const countEl = document.getElementById('selectedCount');

    function refresh() {
      let c = 0;
      for (const row of notes) {
        const cb = row.querySelector('input[type="checkbox"]');
        const checked = !!(cb && cb.checked);
        row.classList.toggle('checked', checked);
        if (checked) c += 1;
      }
      if (countEl) countEl.textContent = String(c);
    }

    for (const row of notes) {
      const cb = row.querySelector('input[type="checkbox"]');
      if (!cb) continue;
      cb.addEventListener('change', refresh);
    }
    refresh();
  })();
</script>
{% endblock %}