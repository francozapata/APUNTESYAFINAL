{% extends "base.html" %}
{% block content %}
<div class="card" style="max-width:900px;margin:32px auto">
    <h2>{{ 'Actualizar datos académicos' if mode == 'update' else 'Completá tu perfil' }}</h2>
    {% if name %}<p class="lead">¡Hola {{ name }}! Necesitamos estos datos para organizar los apuntes.</p>{% endif %}

    <form method="POST" action="{{ url_for('complete_profile') }}" id="completeProfileForm">
        {% set prefix = 'cp' %}
        {% set names = {'university':'university','faculty':'faculty','career':'career'} %}
        {% include 'components/academics_selects.html' %}

        <button class="btn primary" type="submit">
            {{ 'Guardar cambios' if mode == 'update' else 'Guardar y continuar' }}
        </button>
        <p class="muted" style="margin-top:10px">Podrás editar esta información luego desde tu perfil.</p>
    </form>
</div>

<script src="{{ url_for('static', filename='js/academics_selects.js') }}?v=1"></script>
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const api = await window.initAcademicsSelects({ prefix: 'cp', enableCreate: true });
        const form = document.getElementById('completeProfileForm');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            try { await api.resolveHidden(); } catch (err) { alert(err.message); return; }
            form.submit();
        });
    });
</script>
{% endblock %}