{% extends "base.html" %}
{% block content %}

<style>
  .profile-shell { max-width: 980px; margin: 32px auto; }
  .profile-card { background:#fff; border-radius:16px; border:1px solid #e5e7f5; padding:22px 20px; box-shadow:0 10px 30px rgba(15,23,42,.05); }
  .profile-header { display:flex; gap:20px; align-items:center; margin-bottom:16px; }
  .profile-avatar { width:88px; height:88px; border-radius:50%; object-fit:cover; border:3px solid #eef; box-shadow:0 0 0 4px rgba(68,120,255,.12); background:#f4f4ff; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:28px; color:#4b5563; }
  .profile-name { font-size:22px; font-weight:700; margin:0 0 4px; color:#111827; }
  .profile-email { font-size:14px; color:#6b7280; margin:0; }
  .profile-chip { display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; background:#f3f4ff; border:1px solid #e0e4ff; font-size:12px; color:#4b5563; margin-top:6px; }
  .muted { color:#6b7280; font-size:13px; }

  .profile-tabs { display:inline-flex; gap:8px; margin:8px 0 18px; padding:4px; border-radius:999px; background:#f7f9ff; border:1px solid #e0e4ff; flex-wrap:wrap; }
  .profile-tab { padding:6px 14px; border-radius:999px; font-size:13px; font-weight:600; text-decoration:none; background:transparent; border:none; color:#4b5563; display:inline-flex; align-items:center; gap:4px; }
  .profile-tab.active { background:#4478ff; color:#fff; box-shadow:0 8px 20px rgba(68,120,255,.35); }

  .profile-wrapper { display:grid; grid-template-columns:minmax(0,2fr) minmax(0,1.4fr); gap:24px; }
  .profile-col { min-width:0; }
  .profile-section-title { font-size:16px; font-weight:600; margin:8px 0 4px; color:#111827; }

  .note-row { display:flex; justify-content:space-between; gap:12px; align-items:center; padding:10px 12px; border-radius:14px; border:1px solid #e5e7f5; background:#fafbff; margin-top:10px; }
  .note-meta { font-size:12px; color:#6b7280; margin-top:3px; }
  .note-actions { display:flex; align-items:center; gap:8px; flex-shrink:0; }

  .badge-free, .badge-paid { padding:3px 9px; font-size:11px; border-radius:999px; border:1px solid transparent; font-weight:600; }
  .badge-status { padding:3px 9px; font-size:11px; border-radius:999px; border:1px solid transparent; font-weight:700; text-transform:uppercase; letter-spacing:.02em; }

  .status-approved { background:#e8fff0; color:#166534; border-color:#bbf7d0; }
  .status-pending_ai { background:#eef2ff; color:#3730a3; border-color:#c7d2fe; }
  .status-pending_manual { background:#fff7ed; color:#9a3412; border-color:#fed7aa; }
  .status-rejected { background:#fee2e2; color:#991b1b; border-color:#fecaca; }

  .badge-free { background:#e8fff0; color:#166534; border-color:#bbf7d0; }
  .badge-paid { background:#fff4e5; color:#92400e; border-color:#fed7aa; }

  .btn-pill { padding:7px 13px; border-radius:999px; border:none; background:#f3f6ff; color:#334155; font-size:13px; font-weight:600; cursor:pointer; text-decoration:none; border:1px solid #dfe4ff; }
  .btn-pill.ghost { background:#fff; color:#111827; border:1px solid #dfe4ff; }

  .profile-right-box { border-radius:14px; border:1px solid #e5e7f5; padding:12px 14px; background:#fafbff; margin-top:10px; }
  .profile-right-box h4 { font-size:14px; margin:0 0 6px; color:#111827; }

  .profile-contact-label { font-size:13px; color:#4b5563; margin-bottom:2px; }

  .academic-update { margin-top:10px; padding:10px 12px; border-radius:12px; background:#f8fafc; border:1px dashed #cbd2ff; display:flex; justify-content:space-between; gap:12px; align-items:center; flex-wrap:wrap; }

  .mp-status { display:inline-flex; align-items:center; gap:6px; font-size:13px; }
  .mp-status-dot { width:8px; height:8px; border-radius:999px; background:#22c55e; }
  .mp-status-dot.off { background:#d4d4d8; }
  .mp-status-text-off { color:#6b7280; }

  @media (max-width: 880px) {
    .profile-card { padding:20px 16px; }
    .profile-header { flex-direction:column; align-items:flex-start; }
    .profile-wrapper { grid-template-columns:minmax(0,1fr); }
    .note-row { flex-direction:column; align-items:flex-start; }
    .note-actions { align-self:flex-end; }
  }
</style>

<div class="profile-shell">
  <div class="profile-card">

    <!-- HEADER -->
    <div class="profile-header">
      <div>
        {% if current_user.avatar_filename %}
          <img src="{{ url_for('user_avatar', user_id=current_user.id) }}" alt="Foto de perfil" class="profile-avatar">
        {% else %}
          <div class="profile-avatar">
            {{ (current_user.name or current_user.email)[0:1].upper() }}
          </div>
        {% endif %}
      </div>
      <div>
        <h1 class="profile-name">{{ current_user.name or "Usuario sin nombre" }}</h1>
        <p class="profile-email">{{ current_user.email }}</p>
        <div class="profile-chip">
          Mi perfil en ApuntesYa
          {% if current_user.mp_user_id %} · Modo vendedor activo {% else %} · Modo vendedor pendiente {% endif %}
        </div>
      </div>
    </div>

    <!-- CONTENIDO -->
    <div class="profile-wrapper">

      <!-- Columna izquierda -->
      <div class="profile-col">

        <p class="muted" style="margin-bottom:6px;">
          Si querés que los compradores puedan contactarte por fuera de ApuntesYa
          (por ejemplo, para clases particulares o más materiales), podés dejar un link de contacto.
        </p>

        <div class="profile-right-box" style="margin-top:10px;">
          <h4>Mis datos de contacto (visible en mi perfil de vendedor)</h4>
          <form method="post" action="{{ url_for('profile_update_contact') }}">
            <div style="display:grid;grid-template-columns:1fr;gap:10px;">
              <div>
                <div class="profile-contact-label">Teléfono / WhatsApp</div>
                <input name="contact_whatsapp" value="{{ contact_whatsapp }}" placeholder="Ej: +54 9 351 123 4567"
                  style="width:100%;padding:10px;border-radius:12px;border:1px solid #e5e7f5;" />
              </div>
              <div>
                <div class="profile-contact-label">Email de contacto</div>
                <input name="contact_email" type="email" value="{{ contact_email }}" placeholder="Ej: tuemail@gmail.com"
                  style="width:100%;padding:10px;border-radius:12px;border:1px solid #e5e7f5;" />
              </div>
              <div>
                <div class="profile-contact-label">Instagram</div>
                <input name="contact_instagram" value="{{ contact_instagram }}" placeholder="Ej: @tuusuario"
                  style="width:100%;padding:10px;border-radius:12px;border:1px solid #e5e7f5;" />
              </div>
              <div>
                <div class="profile-contact-label">Web / Portfolio</div>
                <input name="contact_website" value="{{ contact_website }}" placeholder="Ej: https://tusitio.com"
                  style="width:100%;padding:10px;border-radius:12px;border:1px solid #e5e7f5;" />
              </div>

              <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center;">
                <label class="muted" style="display:flex;gap:8px;align-items:center;">
                  <input type="checkbox" name="contact_visible_public" value="1" {% if contact_visible_public %}checked{% endif %}>
                  Mostrar públicamente (en mi perfil de vendedor)
                </label>
                <label class="muted" style="display:flex;gap:8px;align-items:center;">
                  <input type="checkbox" name="contact_visible_buyers" value="1" {% if contact_visible_buyers %}checked{% endif %}>
                  Mostrar a compradores (luego de compra aprobada)
                </label>
              </div>

              <div>
                <button class="btn-pill" type="submit">Guardar contactos</button>
              </div>

              <div class="muted" style="font-size:12px;">
                Tip: si cargás WhatsApp, se mostrará como botón directo. Si no, podés usar el teléfono simple.
              </div>
            </div>

            <input type="hidden" name="seller_contact" value="{{ seller_contact }}" />
          </form>
        </div>

      </div>

      <!-- Columna derecha -->
      <div class="profile-col">

        <div class="profile-right-box">
          <h4>Datos de mi cuenta</h4>

          <p class="profile-contact-label">Nombre completo</p>
          <p>{{ current_user.name or 'Sin nombre cargado' }}</p>

          <p class="profile-contact-label">Correo electrónico</p>
          <p>{{ current_user.email }}</p>

          <p class="muted" style="margin:0 0 6px;">Datos académicos</p>
          <p style="margin:0;font-weight:700;font-size:16px;">
            {{ current_user.university or 'Universidad no indicada' }}<br>
            <span class="muted" style="font-size:14px;">
              {{ current_user.faculty or 'Facultad no indicada' }} • {{ current_user.career or 'Carrera no indicada' }}
            </span>
          </p>

          <div class="academic-update">
            <p class="muted" style="margin:0;">
              ¿Querés cambiar tu universidad, facultad o carrera? Podés actualizar tus datos académicos cuando lo necesites.
            </p>
            <a href="{{ url_for('update_academics_get') }}" class="btn-pill ghost">Actualizar datos académicos</a>
          </div>
        </div>

        <div class="profile-right-box">
          <h4>Cuenta de Mercado Pago</h4>
          {% if current_user.mp_user_id %}
            <p class="mp-status"><span class="mp-status-dot"></span><span>Cuenta de Mercado Pago conectada</span></p>
            <p class="muted" style="margin-top:6px;">Los pagos de tus ventas se acreditan en esta cuenta.</p>
          {% else %}
            <p class="mp-status mp-status-text-off"><span class="mp-status-dot off"></span><span>Sin cuenta de Mercado Pago vinculada</span></p>
            <p class="muted" style="margin:6px 0 8px;">Para recibir pagos por tus ventas, vas a necesitar vincular una cuenta de Mercado Pago.</p>
            <a href="{{ url_for('connect_mp') }}" class="btn-pill">Vincular Mercado Pago</a>
          {% endif %}
        </div>

        <div class="profile-right-box">
          <h4>Estado como vendedor</h4>
          {% if current_user.mp_user_id %}
            <p class="muted" style="margin-bottom:4px;">Tenés el modo vendedor activo ✅</p>
            <p class="muted">Ya podés subir apuntes y recibir pagos por las ventas en tu cuenta de Mercado Pago conectada.</p>
          {% else %}
            <p class="muted" style="margin-bottom:4px;">Todavía no tenés activo el modo vendedor.</p>
            <p class="muted">Para activarlo, primero vinculá tu cuenta de Mercado Pago desde este mismo perfil. Después vas a poder subir apuntes y recibir pagos.</p>
          {% endif %}
        </div>

      </div>
    </div>

  </div>
</div>

{% endblock %}
