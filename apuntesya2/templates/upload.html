{% extends "base.html" %}
{% block content %}
<div class="card" style="max-width:1200px;margin:32px auto">
  <h2>Subir apunte (PDF)</h2>
  <form method="post" enctype="multipart/form-data" id="uploadForm">
    <label>Título</label><input class="input" name="title" required>
    <label>Descripción</label><input class="input" name="description" required>

    {% set prefix = 'up' %}
    {% set names = {'university':'university','faculty':'faculty','career':'career'} %}
    {% include 'components/academics_selects.html' %}

    <label style="margin-top:14px">Precio (ARS). Dejar en blanco para gratis</label>
    <input class="input" name="price" type="number" min="0" step="0.01">

    <div class="card" style="margin-top:16px">
      <h3>Información importante</h3>
      <ul class="list-disc pl-6">
        <li>La plataforma aplica una <strong>comisión del {{ config.PLATFORM_FEE_PCT or 5 }}%</strong>.</li>
        <li><strong>Mercado Pago</strong> puede aplicar costos y/o retenciones adicionales.</li>
        {% if config.IIBB_ENABLED %}
        <li>Pueden aplicarse retenciones de <strong>IIBB</strong> según jurisdicción.</li>
        {% endif %}
      </ul>
      <p class="mt-2 text-sm">
        ¿Dudas con Mercado Pago?
        <a href="{{ url_for('help_mp') }}" class="text-blue-600 hover:underline">Ver instructivo</a>.
      </p>
    </div>

    <label style="margin-top:14px">Archivo PDF</label>
    <input class="input" type="file" name="file" accept="application/pdf" required>

    <button class="btn" style="margin-top:14px">Subir</button>
  </form>
</div>

<script src="{{ url_for('static', filename='js/academics_selects.js') }}?v=1"></script>
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const api = await window.initAcademicsSelects({ prefix: 'up', enableCreate: true });
    const form = document.getElementById('uploadForm');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      try { await api.resolveHidden(); } catch (err) { alert(err.message); return; }
      form.submit();
    });
  });
</script>
{% endblock %}